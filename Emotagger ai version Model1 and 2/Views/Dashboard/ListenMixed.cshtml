@model EmoTagger.Models.ListenMixedViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Model.Tracks üzerinden sıralama yap
    var sortedMusics = Model.Tracks.OrderBy(m => m.musicid).ToList();

    int pageSize = 15;
    int currentPage = Model.CurrentPage;

    int totalItems = sortedMusics.Count;
    int totalPages = Model.TotalPages;

    var pagedItems = sortedMusics.Skip((currentPage - 1) * pageSize).Take(pageSize).ToList();
}
<link rel="stylesheet" href="~/css/listenmixed.css">
<style>
    .table-dark {
        background-color: #ff4444 !important;
    }

    .pagination {
        flex-wrap: wrap;
        justify-content: center;
    }

        .pagination .page-item {
            margin-bottom: 5px;
        }
</style>
<div class="container-fluid py-4">
    <h4 class="mb-4 text-primary">All Music</h4>
    @if (sortedMusics != null && sortedMusics.Any())
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Song Title</th>
                        <th>Artist</th>
                        <th>🎧 Plays</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in pagedItems)
                    {
                        var musicUrl = $"https://emomusicc.vercel.app/music/{Uri.EscapeDataString(item.filename)}";
                        var title = $"{item.title} - {item.artist}";
                        <tr class="cursor-pointer music-row" data-music-id="@item.musicid" onclick="playMusic('@musicUrl', '@Html.Raw(title)', this)">
                            <td>@item.musicid</td>
                            <td>@item.title</td>
                            <td>@item.artist</td>
                            <td>🎧 @(new Random().Next(1000, 100000))</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Tüm sayfaları görüntüleyen sayfalama -->
        <nav aria-label="Sayfalama" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                    <a class="page-link" href="javascript:void(0)" onclick="navigateToPage(@(currentPage - 1))" tabindex="-1">Previous</a>
                </li>

                @for (int i = 1; i <= totalPages; i++)
                {
                    <li class="page-item @(i == currentPage ? "active" : "")">
                        <a class="page-link" href="javascript:void(0)" onclick="navigateToPage(@i)">@i</a>
                    </li>
                }

                <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                    <a class="page-link" href="javascript:void(0)" onclick="navigateToPage(@(currentPage + 1))">Next</a>
                </li>
            </ul>
        </nav>
    }
    else
    {
        <div class="alert alert-warning">
            No music found.
        </div>
    }
</div>
@section Scripts {
    <script>
        // Previous JavaScript remains the same
        function navigateToPage(page) {
            var url = new URL(window.location.href);
            url.searchParams.set('page', page);
            window.location.href = url.toString();
        }
        function playMusic(src, title, element) {
            const audio = document.getElementById("musicPlayer");

            if (!audio) return;

            // localStorage'a son oynatılanı kaydet
            localStorage.setItem("lastPlayedSrc", src);
            localStorage.setItem("lastPlayedTitle", title);

            // Stil
            document.querySelectorAll('.music-row').forEach(row => row.classList.remove('playing-now'));
            if (element) element.classList.add('playing-now');

            // Oynat
            audio.src = src;
            audio.play();

            document.title = title + " 🎵";

            const marquee = document.querySelector('.marquee-content');
            if (marquee) {
                marquee.innerHTML = `<strong>${title}</strong>`;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById("musicPlayer");
            if (audio && audio.src) {
                const currentSrc = audio.src;
                document.querySelectorAll('.music-row').forEach(row => {
                    const onclick = row.getAttribute('onclick');
                    if (onclick && onclick.includes(currentSrc)) {
                        row.classList.add('playing-now');
                    }
                });
            }
        });
    </script>

    <style>
        .music-row {
            transition: all 0.3s ease;
        }

            .music-row:hover {
                background-color: rgba(255, 255, 0, 0.1) !important;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

        .playing-now {
            background-color: rgba(255, 255, 0, 0.6) !important;
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
            color: #000;
            font-weight: bold;
            animation: pulsate 1.5s infinite alternate;
        }
    </style>
}